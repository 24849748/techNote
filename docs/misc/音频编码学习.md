
# 一些基础知识

#### 比特率计算
```
bit rate = sample rate × bit depth × channel
```
比如
* 采样率： 44.1kHz
* 位深： 16bit
* 通道数： 2（立体声）
`44100 × 16 × 2 = 1411200`

#### 文件大小
```
size(byte) =  bit rate(bit/s) × time(s) ÷ 8
```


# PCM
* Pulse Code Modulation，脉冲编码调制，是一种模拟信号的数字化方法
* 实现过程：
    * 采样
    * 量化
    * 编码
    ![20240705102405](https://cdn.jsdelivr.net/gh/24849748/PicBed/ob/20240705102405.png)
* 未经压缩的原始数字音频数据，通常不能直接播放，需要经过像sbc之类的编码

# SBC
* sub band code 子带编码
* 大小中等，质量高，计算不复杂
参数：
- sampling_frequency（采样频率）：常用的是 16KHz，32KHz，44.1KHz 和 48KHz
- channel mode（通道模式）：单声道，双声道，立体声和联合立体声
- block length（块长度）：4, 8, 12, 16
- subbands（子带数量）：4 或 8
- allocation method （分配方式）： SNR 或 loudness
- bitpool（比特池）：范围是 2-250。此值越大，编码产生的数据越长

# mSBC
* mobile sub band code
* 主要用于蓝牙等低带宽无线传输场景
* 将16kHz压缩为64kbps的比特率，同时保留较高音频质量和低延迟
* msbc支持单双声道


### 概述

mSBC是一种低复杂度的音频编码算法，主要用于蓝牙等低带宽无线传输场景中。它将16kHz的音频采样数据压缩为64kbps的比特率，同时保留了较高的音频质量和较低的延迟。mSBC支持单声道和双声道音频数据，可以用于语音通话、音频传输等场景。
### 编码算法

mSBC编码算法将16kHz采样率的音频数据压缩为64kbps的比特率。它采用了子带编码技术，将音频信号分为7个子带，并对每个子带进行独立的编码。

每个子带包含8个4-bit采样值，共计64个比特。mSBC编码算法将每个子带的采样值转换为一个4-bit的线性预测系数，然后用一个固定的码本对这些预测系数进行编码。编码后的比特流按照一定的顺序排列，组成了mSBC音频数据帧。

### 解码算法

mSBC解码算法将64kbps的比特流解码为16kHz采样率的音频数据。它采用了与编码算法类似的子带解码技术，将音频数据帧分为7个子带，并对每个子带进行独立的解码。

每个子带包含64个比特，解码后得到8个4-bit采样值。mSBC解码算法根据这些采样值和线性预测系数，计算出每个子带的16个采样值。最终，将这些采样值按照一定的顺序排列，组成16kHz采样率的音频数据。

### 数据格式

mSBC数据采用8-bit字节表示，每个字节包含两个4-bit的采样值。在mSBC数据帧中，每个字节表示一个子带的两个4-bit采样值。

mSBC数据帧的格式如下：
- 第1个字节：帧控制字节，包含以下控制信息：
    - bit 7：帧同步标志，固定为1。
    - bit 6：帧类型标志，固定为0。
    - bit 5-0：子带选择位，用于指示该数据帧包含哪些子带的数据。
- 第2-9个字节（8 bytes）：链路控制信息，用于表示蓝牙音频链路的相关信息，如连接ID和序列号等。 
- 第10-57个字节（47 bytes：2 + (6 × 8)）：音频数据，包含7个子带的采样值。
- 最后三个字节：CRC校验码，用于检查数据帧的完整性。

### 帧结构

mSBC数据帧的长度为57个字节，其中第10-57个字节包含音频数据，总共包含7个子带的采样值。每个子带包含8个4-bit采样值，共计64个比特。

mSBC数据帧的帧控制字节包含帧同步标志和帧类型标志，用于帧同步和数据帧识别。帧同步标志固定为1，帧类型标志固定为0，表示这是一个mSBC音频数据帧。子带选择位用于指示该数据帧包含哪些子带的数据，采用6-bit二进制表示，可支持最多7个子带（不包括未使用的子带）。

链路控制信息用于表示蓝牙音频链路的相关信息，如连接ID和序列号等。具体格式和含义由蓝牙音频协议规定。

最后三个字节是CRC校验码，用于检查数据帧的完整性。CRC校验码的计算方法和校验过程在mSBC标准协议中有详细的说明。

### 总结

mSBC是一种低复杂度的音频编码算法，主要用于蓝牙等低带宽无线传输场景中。它采用子带编码技术，将音频信号分为7个子带，并对每个子带进行独立的编码。mSBC数据采用8-bit字节表示，每个字节包含两个4-bit的采样值。mSBC数据帧的长度为57个字节，其中音频数据部分包含7个子带的采样值，共计56个采样点。mSBC编解码算法的具体实现和性能优化方案可以根据实际应用场景进行调整。

